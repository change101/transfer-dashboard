<!DOCTYPE html>
<html>
<head>
    <title>Transfer Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body class="bg-gray-100">
    <div class="container mx-auto p-4">
        <h1 class="text-2xl mb-4">Transfer Dashboard</h1>
        <div id="transferData" class="bg-white p-4 rounded shadow">Loading...</div>
    </div>

    <script>
        const API_BASE_URL = 'https://cbb8-4-34-34-186.ngrok-free.app';

        async function fetchTransferData(transactionId) {
            const displayError = (message) => {
                console.error(message);
                document.getElementById('transferData').innerHTML = 
                    `<div class="text-red-500 p-4 rounded bg-red-50">${message}</div>`;
            };

            try {
                if (!transactionId) {
                    displayError('No transaction ID provided');
                    return;
                }

                console.log(`Attempting to fetch data from: ${API_BASE_URL}/api/transaction/${transactionId}`);
                
                const response = await fetch(`${API_BASE_URL}/api/transaction/${transactionId}`, {
                    method: 'GET',
                    headers: {
                        'Accept': 'application/json',
                        'Content-Type': 'application/json'
                    },
                    mode: 'cors'
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const data = await response.json();
                console.log('Received data:', data);

                if (data.status === 'success' && data.transfer_data) {
                    const transferData = data.transfer_data;
                    const details = transferData.details;
                    
                    let html = `
                        <div class="grid grid-cols-2 gap-4">
                            <div class="font-bold">Language:</div>
                            <div>${data.language === 'es' ? 'Spanish' : 'English'}</div>
                            
                            <div class="font-bold">Amount:</div>
                            <div>$${transferData.amount} ${details.currency_from}</div>
                            
                            <div class="font-bold">Destination:</div>
                            <div>${transferData.country.toUpperCase()}</div>
                            
                            <div class="font-bold">Exchange Rate:</div>
                            <div>1 ${details.currency_from} = ${details.exchange_rate} ${details.currency_to}</div>
                            
                            <div class="font-bold">Transfer Fee:</div>
                            <div>$${details.transfer_fee}</div>
                            
                            <div class="font-bold">Total Amount:</div>
                            <div>$${details.total_amount} ${details.currency_from}</div>
                            
                            <div class="font-bold">Amount to Receive:</div>
                            <div>${details.amount_to} ${details.currency_to}</div>
                            
                            <div class="font-bold">Delivery Method:</div>
                            <div>${details.delivery_method}</div>
                        </div>
                    `;

                    document.getElementById('transferData').innerHTML = html;
                } else {
                    document.getElementById('transferData').innerHTML = 
                        '<div class="text-yellow-500">No transfer data available</div>';
                }
            } catch (error) {
                displayError(`Error loading data: ${error.message}. Please check console for details.`);
                console.error('Full error:', error);
            }
        }

        // When page loads
        document.addEventListener('DOMContentLoaded', () => {
            console.log('Page loaded, checking for transaction ID...');
            const urlParams = new URLSearchParams(window.location.search);
            const transactionId = urlParams.get('id');
            console.log('Transaction ID from URL:', transactionId);
            
            if (transactionId) {
                fetchTransferData(transactionId);
                // Poll for updates every 5 seconds
                setInterval(() => fetchTransferData(transactionId), 5000);
            } else {
                document.getElementById('transferData').innerHTML = 
                    '<div class="text-yellow-500">No transaction ID provided in URL</div>';
            }
        });
    </script>
</body>
</html>
