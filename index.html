<!DOCTYPE html>
<html>
<head>
    <title>Transfer Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body class="bg-gray-100">
    <div class="container mx-auto p-4">
        <h1 class="text-2xl mb-4">Transfer Dashboard</h1>
        <div id="transferData" class="bg-white p-4 rounded shadow">Loading...</div>
    </div>

    <script>
        // Function to display error messages
        function showError(message) {
            document.getElementById('transferData').innerHTML = `
                <div class="text-red-500 p-4 bg-red-50 rounded">
                    <p class="font-bold">Error:</p>
                    <p>${message}</p>
                </div>
            `;
        }

        // Function to display transfer data
        function showTransferData(data) {
            const transferData = data.transfer_data;
            const details = transferData.details;

            const html = `
                <div class="grid grid-cols-2 gap-4">
                    <div class="font-bold">Language:</div>
                    <div>${data.language === 'es' ? 'Spanish' : 'English'}</div>
                    
                    <div class="font-bold">Amount:</div>
                    <div>$${transferData.amount} ${details.currency_from}</div>
                    
                    <div class="font-bold">Destination:</div>
                    <div>${transferData.country.toUpperCase()}</div>
                    
                    <div class="font-bold">Exchange Rate:</div>
                    <div>1 ${details.currency_from} = ${details.exchange_rate} ${details.currency_to}</div>
                    
                    <div class="font-bold">Transfer Fee:</div>
                    <div>$${details.transfer_fee}</div>
                    
                    <div class="font-bold">Total Amount:</div>
                    <div>$${details.total_amount} ${details.currency_from}</div>
                    
                    <div class="font-bold">Amount to Receive:</div>
                    <div>${details.amount_to} ${details.currency_to}</div>
                    
                    <div class="font-bold">Delivery Method:</div>
                    <div>${details.delivery_method}</div>
                </div>
            `;

            document.getElementById('transferData').innerHTML = html;
        }

        // Main function to fetch data
        async function loadTransferData() {
            const urlParams = new URLSearchParams(window.location.search);
            const transactionId = urlParams.get('id');

            if (!transactionId) {
                showError('No transaction ID provided');
                return;
            }

            try {
                const response = await fetch(
                    `https://cbb8-4-34-34-186.ngrok-free.app/api/transaction/${transactionId}`,
                    {
                        method: 'GET',
                        headers: {
                            'Accept': 'application/json'
                        }
                    }
                );

                const data = await response.json();
                
                if (data.status === 'success') {
                    showTransferData(data);
                } else {
                    showError(data.message || 'Failed to load transfer data');
                }
            } catch (error) {
                showError(`Error loading data: ${error.message}`);
                console.error('Error details:', error);
            }
        }

        // Start loading when page is ready
        document.addEventListener('DOMContentLoaded', loadTransferData);
    </script>
</body>
</html>
